{
    "commands": [
        {
            "description": "Create string variable for Helm sets",
            "run": [
                "helm_sets=\"\";",
                "general_params=$(jq -r \".subtype.datasources[0].params\" $APP_JSON);"
            ]
        },
        {
            "description": "Append Helm set for taints to helm_sets string",
            "run": [
                "echo \"Getting is taint...\";",
                "is_taint_param=$(find_param \"datasources\" \"$general_params\" \"isTaint\");",
                "value=$(echo \"$is_taint_param\" | jq -r \".value\");",
                "if $value; then",
                    "items=$(kubectl get nodes -o json | jq -r \".items\");",
                    "echo \"Creating Helm sets...\";",
                    "while read -r taint; do",
                        "index=0;",
                        "key=$(echo $taint | jq -r \".key\");",
                        "value=$(echo $taint | jq -r \".value\");",
                        "effect=$(echo $taint | jq -r \".effect\");",
                        "tolerations_sets+=\"--set 'secrets.tolerations[$index].key=$key'\";",
                        "tolerations_sets+=\"--set 'secrets.tolerations[$index].value=$value'\";",
                        "tolerations_sets+=\"--set 'secrets.tolerations[$index].operator=Equal'\";",
                        "tolerations_sets+=\"--set 'secrets.tolerations[$index].effect=$effect'\";",
                        "let index+=1;",
                    "done < <(echo \"$items\" | jq -c \".[].spec.taints[]\");",
                    "helm_sets+=\"$tolerations_sets\";",
                "fi;"
            ]
        },
        {
            "description": "Run logs commands",
            "run": [
                "echo \"Running logs commands...\";",
                "run_commands \"$logs\";"
            ]
        },
        {
            "description": "Run metrics commands",
            "run": [
                "echo \"Running metrics commands...\";",
                "run_commands \"$metrics\";"
            ]
        },
        {
            "description": "Run Helm install",
            "run": [
                "echo \"Running Helm install...\";",
                "echo \"$helm_sets\";",
                "helm install $helm_sets logzio-otel-k8s-metrics logzio-helm/logzio-otel-k8s-metrics;",
                "echo \"The Helm chart was installed successfully\";"
            ]
        }
    ]
}