{
    "commands": [
        {
            "description": "Create boolean variable for is metric option chosen",
            "run": [
                "isMetricsOption=true;",
                "metricsParams=$(jq -r \".subtype.datasources[0].telemetries[1].params\" $app_json);"
            ]
        },
        {
            "description": "Is metrics option chosen by the user?",
            "run": [
                "if [ \"$metricsParams\" == [] ]; then",
                    "isMetricsOption=false;",
                "fi;"
            ]
        },
        {
            "description": "Append Helm set for Logz.io metrics listener to helmSets string",
            "run": [
                "if [ isMetricsOption ]; then",
                    "logzioMetricsListenerParam=\"\";",
                    "while read -r param; do",
                        "name=$(echo $param | jq -r \".name\");",
                        "if [ $name != \"logzioMetricsListener\" ]; then",
                            "continue;",
                        "fi;",
                        "logzioMetricsListenerParam=$param;",
                        "break;",
                    "done < <(echo $metricsParams | jq -c \".[]\");",
                    "value=$(echo $logzioMetricsListenerParam | jq -r \".value\");",
                    "helmSet=\"--set secrets.logzioMetricsListener=\\'$value\\'\");",
                    "helmSets+=\"$helmSet\";",
                "fi;"
            ]
        },
        {
            "description": "Append Helm set for Logz.io metrics token to helmSets string",
            "run": [
                "if [ isMetricsOption ]; then",
                    "logzioMetricsTokenParam=\"\";",
                    "while read -r param; do",
                        "name=$(echo $param | jq -r \".name\");",
                        "if [ $name != \"logzioMetricsToken\" ]; then",
                            "continue;",
                        "fi;",
                        "logzioMetricsListenerParam=$param;",
                        "break;",
                    "done < <(echo $metricsParams | jq -c \".[]\");",
                    "value=$(echo $logzioMetricsTokenParam | jq -r \".value\");",
                    "helmSet=\"--set secrets.logzioMetricsToken=\\'$value\\'\");",
                    "helmSets+=\"$helmSet\";",
                "fi;"
            ]
        }
    ]
}