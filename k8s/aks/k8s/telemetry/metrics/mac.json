{
    "commands": [
        {
            "description": "Create boolean variable for is metrics option selected",
            "run": [
                "is_metrics_option_selected=true;",
                "metrics_params=$(jq -r \".subtype.datasources[0].telemetries[1].params\" $APP_JSON);"
            ]
        },
        {
            "description": "Is metrics option selected?",
            "run": [
                "if [ \"$metrics_params\" = [] ]; then",
                    "is_metrics_option_selected=false;",
                    "echo \"Metrics option was not selected\";",
                "else",
                    "echo \"Metrics option was selected\";",
                "fi;"
            ]
        },
        {
            "description": "Append Helm set for Logz.io metrics listener to helm_sets string",
            "run": [
                "if $is_metrics_option_selected; then",
                    "echo \"Getting Logz.io metrics listener...\";",
                    "logzio_metrics_listener_param=$(find_param \"metrics\" \"$metrics_params\" \"logzioMetricsListener\");",
                    "value=$(echo \"$logzio_metrics_listener_param\" | jq -r \".value\");",
                    "echo \"Creating Helm set...\";",
                    "helm_set=\"--set 'secrets.ListenerHost=$value'\";",
                    "helm_sets+=\" $helm_set\";",
                "fi;"
            ]
        },
        {
            "description": "Append Helm set for Logz.io metrics token to helm_sets string",
            "run": [
                "if $is_metrics_option_selected; then",
                    "echo \"Getting Logz.io metrics token...\";",
                    "logzio_metrics_token_param=$(find_param \"metrics\" \"$metrics_params\" \"logzioMetricsToken\");",
                    "value=$(echo \"$logzio_metrics_token_param\" | jq -r \".value\");",
                    "echo \"Creating Helm set...\";",
                    "helm_set=\"--set 'secrets.MetricsToken=$value'\";",
                    "helm_sets+=\" $helm_set\";",
                "fi;"
            ]
        },
        {
            "description": "Append Helm set for metrics environment to helm_sets string",
            "run": [
                "if $is_metrics_option_selected; then",
                    "echo \"Getting metrics environment...\";",
                    "metrics_env_param=$(find_param \"metrics\" \"$metrics_params\" \"metricsEnv\");",
                    "value=$(echo \"$metrics_env_param\" | jq -r \".value\");",
                    "echo \"Creating Helm set...\";",
                    "helm_set=\"--set 'secrets.p8s_logzio_name=$value'\";",
                    "helm_sets+=\" $helm_set\";",
                "fi;"
            ]
        }
    ]
}