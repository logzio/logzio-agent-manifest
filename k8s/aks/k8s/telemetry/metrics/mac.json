{
    "commands": [
        {
            "description": "Create boolean variable for is metrics option selected",
            "run": [
                "isMetricsOptionSelected=true;",
                "metricsParams=$(jq -r \".subtype.datasources[0].telemetries[1].params\" $appJson);"
            ]
        },
        {
            "description": "Is metrics option selected?",
            "run": [
                "if [ \"$metricsParams\" = [] ]; then",
                    "isMetricsOptionSelected=false;",
                    "echo \"Metrics option was not selected\";",
                "else",
                    "echo \"Metrics option was selected\";",
                "fi;"
            ]
        },
        {
            "description": "Append Helm set for Logz.io metrics listener to helmSets string",
            "run": [
                "if $isMetricsOptionSelected; then",
                    "echo \"Getting Logz.io metrics listener...\";",
                    "logzioMetricsListenerParam=\"\";",
                    "while read -r param; do",
                        "name=$(echo \"$param\" | jq -r \".name\");",
                        "if [ $name != \"logzioMetricsListener\" ]; then",
                            "continue;",
                        "fi;",
                        "logzioMetricsListenerParam=$param;",
                        "break;",
                    "done < <(echo \"$metricsParams\" | jq -c \".[]\");",
                    "value=$(echo \"$logzioMetricsListenerParam\" | jq -r \".value\");",
                    "echo \"Creating Helm set...\";",
                    "helmSet=\"--set secrets.ListenerHost=\\'$value\\'\";",
                    "helmSets+=\" $helmSet\";",
                "fi;"
            ]
        },
        {
            "description": "Append Helm set for Logz.io metrics token to helmSets string",
            "run": [
                "if $isMetricsOptionSelected; then",
                    "echo \"Getting Logz.io metrics token...\";",
                    "logzioMetricsTokenParam=\"\";",
                    "while read -r param; do",
                        "name=$(echo \"$param\" | jq -r \".name\");",
                        "if [ $name != \"logzioMetricsToken\" ]; then",
                            "continue;",
                        "fi;",
                        "logzioMetricsTokenParam=$param;",
                        "break;",
                    "done < <(echo \"$metricsParams\" | jq -c \".[]\");",
                    "value=$(echo \"$logzioMetricsTokenParam\" | jq -r \".value\");",
                    "echo \"Creating Helm set...\";",
                    "helmSet=\"--set secrets.MetricsToken=\\'$value\\'\";",
                    "helmSets+=\" $helmSet\";",
                "fi;"
            ]
        },
        {
            "description": "Append Helm set for metrics environment to helmSets string",
            "run": [
                "if $isMetricsOptionSelected; then",
                    "echo \"Getting metrics environment...\";",
                    "metricsEnvParam=\"\";",
                    "while read -r param; do",
                        "name=$(echo \"$param\" | jq -r \".name\");",
                        "if [ $name != \"metricsEnv\" ]; then",
                            "continue;",
                        "fi;",
                        "metricsEnvParam=$param;",
                        "break;",
                    "done < <(echo \"$metricsParams\" | jq -c \".[]\");",
                    "value=$(echo \"$metricsEnvParam\" | jq -r \".value\");",
                    "echo \"Creating Helm set...\";",
                    "helmSet=\"--set secrets.p8s_logzio_name=\\'$value\\'\";",
                    "helmSets+=\" $helmSet\";",
                "fi;"
            ]
        }
    ]
}